<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>YAMADOG Mint</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
    body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #111;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
    }

    .card {
        width: 100%;
        max-width: 420px;
        padding: 24px;
        border-radius: 16px;
        background: #1a1a1a;
        box-shadow: 0 0 40px rgba(0,0,0,.6);
        text-align: center;
    }

    h1 {
        margin-bottom: 8px;
        font-size: 28px;
    }

    p {
        font-size: 14px;
        opacity: 0.8;
        line-height: 1.5;
    }

    button {
        width: 100%;
        padding: 14px;
        margin-top: 12px;
        border-radius: 12px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        background: #f4c430;
        color: #000;
    }

    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .status {
        margin-top: 16px;
        font-size: 13px;
        min-height: 18px;
        opacity: 0.9;
    }

    .wallet {
        margin-top: 8px;
        font-size: 13px;
        opacity: 0.7;
        word-break: break-all;
    }
</style>
</head>

<body>

<div class="card">
    <h1>YAMADOG üêï</h1>
    <p>Mint by burning <b>2,000 YAMA</b><br>
    Fully on-chain ‚Ä¢ Sepolia Testnet</p>

    <button id="connectBtn">Connect Wallet</button>
    <button id="mintBtn" disabled>Mint YAMADOG</button>

    <div class="wallet" id="wallet"></div>
    <div class="status" id="status"></div>
</div>

<script>
/* ---------------- CONFIG ---------------- */

const SEPOLIA_CHAIN_ID = "0xaa36a7"; // 11155111

const NFT_ADDRESS  = "0x77CA6E72CdfA303E3Ee1065cd672DC73eB4EB88e";
const ERC20_ADDRESS = "0xc9F6Ea476EBA9d82cdF88fE830642C0131bfA4c3";

const MINT_PRICE = ethers.utils.parseUnits("2000", 18);

/* ---------------- ABI ---------------- */

const ERC20_ABI = [
    "function balanceOf(address) view returns (uint256)",
    "function allowance(address,address) view returns (uint256)",
    "function approve(address,uint256) returns (bool)"
];

const NFT_ABI = [
    "function mint()",
    "function totalSupply() view returns (uint256)",
    "function MAX_SUPPLY() view returns (uint256)"
];

/* ---------------- STATE ---------------- */

let provider, signer, user;
let erc20, nft;

/* ---------------- UI ---------------- */

const connectBtn = document.getElementById("connectBtn");
const mintBtn = document.getElementById("mintBtn");
const statusEl = document.getElementById("status");
const walletEl = document.getElementById("wallet");

/* ---------------- FUNCTIONS ---------------- */

function setStatus(msg) {
    statusEl.textContent = msg;
}

async function ensureSepolia() {
    const chainId = await window.ethereum.request({ method: "eth_chainId" });
    if (chainId !== SEPOLIA_CHAIN_ID) {
        await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: SEPOLIA_CHAIN_ID }]
        });
    }
}

async function connectWallet() {
    if (!window.ethereum) {
        alert("MetaMask not detected");
        return;
    }

    await ensureSepolia();

    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();

    const accounts = await provider.send("eth_requestAccounts", []);
    user = accounts[0];

    erc20 = new ethers.Contract(ERC20_ADDRESS, ERC20_ABI, signer);
    nft   = new ethers.Contract(NFT_ADDRESS, NFT_ABI, signer);

    walletEl.textContent = `Connected: ${user}`;
    connectBtn.textContent = "Wallet Connected";
    connectBtn.disabled = true;
    mintBtn.disabled = false;

    setStatus("Wallet connected");
}

async function mint() {
    try {
        mintBtn.disabled = true;
        setStatus("Checking balance...");

        const balance = await erc20.balanceOf(user);
        if (balance.lt(MINT_PRICE)) {
            throw new Error("Not enough YAMA (need 2000)");
        }

        setStatus("Checking allowance...");
        const allowance = await erc20.allowance(user, NFT_ADDRESS);

        if (allowance.lt(MINT_PRICE)) {
            setStatus("Approving YAMA...");
            const approveTx = await erc20.approve(NFT_ADDRESS, MINT_PRICE);
            await approveTx.wait();
        }

        setStatus("Minting YAMADOG...");
        const mintTx = await nft.mint();
        await mintTx.wait();

        setStatus("‚úÖ Mint successful!");
    } catch (err) {
        console.error(err);
        setStatus(err.message || "Transaction failed");
    } finally {
        mintBtn.disabled = false;
    }
}

/* ---------------- EVENTS ---------------- */

connectBtn.onclick = connectWallet;
mintBtn.onclick = mint;

</script>
</body>
</html>
