<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>YAMADOG NFT Mint</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#0b0b0b;
  color:#fff;
  text-align:center;
  padding:20px;
}
button {
  padding:12px 18px;
  margin:8px;
  font-size:16px;
  cursor:pointer;
}
.card {
  background:#161616;
  padding:20px;
  border-radius:10px;
  margin:15px auto;
  max-width:420px;
}
.banner {
  background:#ffcc00;
  color:#000;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
  display:none;
}
.stat {
  font-size:18px;
  margin:6px 0;
}
</style>
</head>

<body>

<h1>üêï YAMADOG NFT Mint</h1>
<p>Mint price: <b>2000 YAMA</b></p>

<div id="mobileBanner" class="banner">
  üì± Mobile users: please open this site inside  
  <b>MetaMask</b> or <b>Trust Wallet</b> browser
  <br><br>
  <button onclick="openMetaMask()">Open in MetaMask</button>
  <button onclick="openTrust()">Open in Trust Wallet</button>
</div>

<div class="card">
  <h3>üî• Burn Statistics</h3>
  <div class="stat">Initial Supply: <span id="initial">10,000,000</span> YAMA</div>
  <div class="stat">Current Supply: <span id="totalSupply">Loading‚Ä¶</span> YAMA</div>
  <div class="stat">Burned: <span id="burned">Loading‚Ä¶</span> YAMA</div>
</div>

<div class="card">
  <button onclick="connectWallet()">Connect Wallet</button>
  <button onclick="mint()">Mint NFT</button>
  <p id="status"></p>
</div>

<script>
/* ---------------- CONFIG ---------------- */

const NFT_ADDRESS  = "0x77CA6E72CdfA303E3Ee1065cd672DC73eB4EB88e";
const ERC20_ADDRESS = "0xc9F6Ea476EBA9d82cdF88fE830642C0131bfA4c3";

const MINT_PRICE = ethers.utils.parseUnits("2000", 18);
const INITIAL_SUPPLY = ethers.utils.parseUnits("10000000", 18);

const SEPOLIA_RPC = "https://rpc.sepolia.org";
const SEPOLIA_CHAIN_ID = "0xaa36a7";

/* ---------------- ABI ---------------- */

const NFT_ABI = [/* shortened for readability */{"inputs":[],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"}];

const ERC20_ABI = [
{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];

/* ---------------- BURN STATS (RPC ONLY) ---------------- */

async function loadBurnStats() {
  try {
    const provider = new ethers.providers.JsonRpcProvider(SEPOLIA_RPC);
    const erc20 = new ethers.Contract(ERC20_ADDRESS, ERC20_ABI, provider);

    const total = await erc20.totalSupply();
    const burned = INITIAL_SUPPLY.sub(total);

    document.getElementById("totalSupply").innerText =
      ethers.utils.formatUnits(total, 18);

    document.getElementById("burned").innerText =
      ethers.utils.formatUnits(burned, 18);
  } catch (e) {
    console.error(e);
    document.getElementById("totalSupply").innerText = "Error";
    document.getElementById("burned").innerText = "Error";
  }
}

/* ---------------- WALLET ---------------- */

let signer;

async function connectWallet() {
  if (!window.ethereum) {
    alert("No wallet detected");
    return;
  }

  await ethereum.request({ method: "eth_requestAccounts" });

  if (ethereum.chainId !== SEPOLIA_CHAIN_ID) {
    await ethereum.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: SEPOLIA_CHAIN_ID }]
    });
  }

  const provider = new ethers.providers.Web3Provider(window.ethereum);
  signer = provider.getSigner();

  document.getElementById("status").innerText = "Wallet connected";
}

/* ---------------- MINT FLOW ---------------- */

async function mint() {
  if (!signer) {
    alert("Connect wallet first");
    return;
  }

  try {
    const erc20 = new ethers.Contract(ERC20_ADDRESS, ERC20_ABI, signer);
    const nft = new ethers.Contract(NFT_ADDRESS, NFT_ABI, signer);

    document.getElementById("status").innerText = "Approving YAMA‚Ä¶";
    const tx1 = await erc20.approve(NFT_ADDRESS, MINT_PRICE);
    await tx1.wait();

    document.getElementById("status").innerText = "Minting NFT‚Ä¶";
    const tx2 = await nft.mint();
    await tx2.wait();

    document.getElementById("status").innerText = "‚úÖ Mint successful";
    loadBurnStats();

  } catch (e) {
    console.error(e);
    document.getElementById("status").innerText = "‚ùå Transaction failed";
  }
}

/* ---------------- MOBILE UX ---------------- */

function isMobile() {
  return /android|iphone|ipad|mobile/i.test(navigator.userAgent);
}

function openMetaMask() {
  window.location.href =
    "https://metamask.app.link/dapp/" + window.location.hostname;
}

function openTrust() {
  window.location.href =
    "https://link.trustwallet.com/open_url?url=" + window.location.href;
}

/* ---------------- INIT ---------------- */

if (isMobile() && !window.ethereum) {
  document.getElementById("mobileBanner").style.display = "block";
}

loadBurnStats();
</script>

</body>
</html>
